"use strict";(self.webpackChunkloan_system=self.webpackChunkloan_system||[]).push([[136,491],{562:()=>{},3136:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var s=a(5043),n=a(3216),r=a(5150),l=a(6957),o=a(6435),c=(a(562),a(7488)),i=a(579);const d=[{id:"1",label:"\u0627\u0633\u062a\u0634\u0627\u0631\u064a"},{id:"2",label:"\u062a\u062c\u0647\u064a\u0632"},{id:"3",label:"\u0627\u0639\u0645\u0627\u0644"},{id:"4",label:"\u0627\u062e\u0631\u0649"}],m=[{id:"1",Status:"\u0645\u0633\u062a\u0645\u0631"},{id:"2",Status:"\u0645\u0646\u062c\u0632"}],u=e=>{let{title:t,description:a}=e;(0,c.oR)((0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:t}),(0,i.jsx)("div",{children:a})]}),{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})};function h(e){let{contractId:t,onClose:a}=e;const c=(0,n.Zp)(),h=t,x=Boolean(h),[v,p]=(0,s.useState)(!1),[j,g]=(0,s.useState)(!1),[N,f]=(0,s.useState)(""),[b,C]=(0,s.useState)(""),[y,w]=(0,s.useState)([]),[A,S]=(0,s.useState)(!1),[k,D]=(0,s.useState)(""),[I,P]=(0,s.useState)({ContractNumber:"",ContractName:"",ContractType:"",CompanyName:"",Status:"",LoanId:"",ContractSigningDate:"",StartDate:"",CompleteDate:"",DurationInDays:"",AddedDays:"",ContractAmount:"",CostPlanMins:"",CostAfterChange:"",CostToNatiBank:"",TotalCostPaid:"",OperationLoanCost:"",CashPaid:"",TaxesAndBlockedmoney:"",PrivateMoneyPaid:"",Notes:"",InsuranceDeposits:"",TaxTrusts:"",Penalties:"",OtherTrusts:""}),[T,L]=(0,s.useState)({}),B=e=>{if(!e||!y.length)return"";const t=y.find((t=>(t.id||t.ID)==e));return t?t.loanName||t.LoanName||t.name||t.Name:""};(0,s.useEffect)((()=>{(async()=>{S(!0);try{var e;const t=await r.A.get("/Loan/GetAllLoans");w((null===(e=t.data)||void 0===e?void 0:e.loans)||[])}catch(t){D("\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0642\u0631\u0648\u0636"),console.error("Error fetching loans:",t)}finally{S(!1)}})(),(async()=>{if(x){p(!0);try{var e,t;const a=await r.A.get(`/Contracts/GetContract/${h}`);let s;if(s=null!==(e=a.data)&&void 0!==e&&e.data?a.data.data:null!==(t=a.data)&&void 0!==t&&t.contract?a.data.contract:a.data,!s||0===Object.keys(s).length)throw new Error("No contract data was returned from the API");const n={};Object.keys(I).forEach((e=>{const t=Object.keys(s).find((t=>t.toLowerCase()===e.toLowerCase()));t&&(n[e]=s[t])})),["ContractSigningDate","StartDate","CompleteDate"].forEach((e=>{if(n[e]){const t=new Date(n[e]);isNaN(t)||(n[e]=t.toISOString().split("T")[0])}})),P((e=>({...e,...n})))}catch(n){var a,s;f((null===(a=n.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||n.message||"\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0639\u0642\u062f."),console.error("Error fetching contract:",n)}finally{p(!1)}}})()}),[h,x]);const E=e=>{const{name:t,value:a}=e.target;T[t]&&L((e=>({...e,[t]:""}))),P((e=>({...e,[t]:["ContractType"].includes(t)?Number(a):a})))},O=function(e,t){var a;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,i.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,i.jsxs)("label",{className:"form-label",children:[e," ",n&&(0,i.jsx)("span",{className:"text-danger",children:"*"})]}),(0,i.jsx)("input",{type:s,name:t,className:"form-control "+(T[t]?"is-invalid":""),value:null!==(a=I[t])&&void 0!==a?a:"",onChange:E,required:n}),T[t]&&(0,i.jsx)("div",{className:"invalid-feedback",children:T[t]})]})};return v?(0,i.jsxs)("div",{className:"d-flex flex-column min-vh-100",children:[(0,i.jsx)(l.A,{}),(0,i.jsx)("main",{className:"flex-fill container my-4 text-center",children:(0,i.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,i.jsx)("span",{className:"visually-hidden",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."})})}),(0,i.jsx)(o.A,{})]}):(0,i.jsxs)("div",{className:"d-flex flex-column min-vh-100",children:[(0,i.jsx)("main",{className:"flex-fill container my-4",children:(0,i.jsxs)("div",{className:"card contract-form-container",children:[(0,i.jsx)("div",{className:"card-header d-flex justify-content-between align-items-center",children:(0,i.jsx)("h2",{className:"mb-0",children:x?"\u062a\u0639\u062f\u064a\u0644 \u0639\u0642\u062f":"\u0625\u0636\u0627\u0641\u0629 \u0639\u0642\u062f \u062c\u062f\u064a\u062f"})}),(0,i.jsxs)("div",{className:"card-body",children:[N&&(0,i.jsx)("div",{className:"alert alert-danger",children:N}),b&&(0,i.jsx)("div",{className:"alert alert-success",children:b}),(0,i.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f(""),C(""),(()=>{const e={};I.ContractNumber.trim()||(e.ContractNumber="\u0631\u0642\u0645 \u0627\u0644\u0639\u0642\u062f \u0645\u0637\u0644\u0648\u0628"),I.ContractName.trim()||(e.ContractName="\u0627\u0633\u0645 \u0627\u0644\u0639\u0642\u062f \u0645\u0637\u0644\u0648\u0628"),["ContractAmount","CostPlanMins","CostAfterChange","CostToNatiBank","TotalCostPaid","OperationLoanCost","CashPaid","TaxesAndBlockedmoney","PrivateMoneyPaid","DurationInDays","AddedDays","InsuranceDeposits","TaxTrusts","Penalties","OtherTrusts"].forEach((t=>{I[t]&&(isNaN(Number(I[t]))||Number(I[t])<0)&&(e[t]="\u064a\u062c\u0628 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0627\u0644\u0642\u064a\u0645\u0629 \u0631\u0642\u0645\u064a\u0629 \u0648\u063a\u064a\u0631 \u0633\u0627\u0644\u0628\u0629")})),I.StartDate&&I.CompleteDate&&new Date(I.StartDate)>new Date(I.CompleteDate)&&(e.CompleteDate="\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0646\u062c\u0627\u0632 \u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0628\u0639\u062f \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0645\u0628\u0627\u0634\u0631\u0629");return L(e),0===Object.keys(e).length})()){g(!0);try{if(x){await r.A.put(`/Contracts/UpdateContract/${h}`,I);const e=B(I.LoanId);u({title:"\u062a\u0645\u062a \u0627\u0644\u062a\u0639\u062f\u064a\u0644 \u0628\u0646\u062c\u0627\u062d",description:`${I.ContractName} \u062a\u0645\u062a \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0639\u0642\u062f \u0628\u0627\u0633\u0645 \u0627\u0644\u0634\u0631\u0643\u0629 ${I.CompanyName}${e?` - \u0627\u0644\u0642\u0631\u0636: ${e}`:""}`}),C("\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0639\u0642\u062f \u0628\u0646\u062c\u0627\u062d!"),a(!0)}else{var t;const e=await r.A.post("/Contracts/AddContract",I);C("\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0639\u0642\u062f \u0628\u0646\u062c\u0627\u062d!"),null!==(t=e.data)&&void 0!==t&&t.id&&(setTimeout((()=>c(`/EditContract/${e.data.id}`)),1500),a(!0))}}catch(o){var s,n,l;console.error("Error saving contract:",o),f(401===(null===(s=o.response)||void 0===s?void 0:s.status)?"\u063a\u064a\u0631 \u0645\u0635\u0631\u062d - \u0627\u0644\u0631\u062c\u0627\u0621 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644.":(null===(n=o.response)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.message)||"\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0627\u0644\u0639\u0642\u062f.")}finally{g(!1)}}else f("\u064a\u0631\u062c\u0649 \u062a\u0635\u062d\u064a\u062d \u0627\u0644\u0623\u062e\u0637\u0627\u0621 \u0641\u064a \u0627\u0644\u0646\u0645\u0648\u0630\u062c \u0642\u0628\u0644 \u0627\u0644\u0625\u0631\u0633\u0627\u0644.")},noValidate:!0,children:[(0,i.jsxs)("div",{className:"row",children:[O("\u0631\u0642\u0645 \u0627\u0644\u0639\u0642\u062f","ContractNumber","text",!0),O("\u0627\u0633\u0645 \u0627\u0644\u0639\u0642\u062f","ContractName","text",!0),(0,i.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:"\u0646\u0648\u0639 \u0627\u0644\u0639\u0642\u062f"}),(0,i.jsxs)("select",{name:"ContractType",className:"form-select",value:I.ContractType,onChange:E,children:[(0,i.jsx)("option",{value:"",children:"-- \u0627\u062e\u062a\u0631 \u0646\u0648\u0639 \u0627\u0644\u0639\u0642\u062f --"}),d.map((e=>{let{id:t,label:a}=e;return(0,i.jsx)("option",{value:t,children:a},t)}))]})]}),O("\u0627\u0633\u0645 \u0627\u0644\u0634\u0631\u0643\u0629","CompanyName"),(0,i.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0639\u0642\u062f"}),(0,i.jsxs)("select",{name:"Status",className:"form-select",value:I.Status,onChange:E,children:[(0,i.jsx)("option",{value:"",children:"-- \u0627\u062e\u062a\u0631 \u062d\u0627\u0644\u0629 \u0627\u0644\u0639\u0642\u062f --"}),m.map((e=>{let{id:t,Status:a}=e;return(0,i.jsx)("option",{value:t,children:a},t)}))]})]}),(0,i.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:"\u0627\u0644\u0642\u0631\u0636"}),(0,i.jsxs)("select",{name:"LoanId",className:"form-select",value:I.LoanId,onChange:E,disabled:A,children:[(0,i.jsx)("option",{value:"",children:"-- \u0627\u062e\u062a\u0631 \u0627\u0644\u0642\u0631\u0636 --"}),y.map((e=>(0,i.jsx)("option",{value:e.id||e.ID,children:e.loanName||e.LoanName||e.name||e.Name},e.id||e.ID)))]}),k&&(0,i.jsx)("small",{className:"text-danger",children:k}),I.LoanId&&(0,i.jsxs)("small",{className:"text-muted d-block mt-1",children:["\u0627\u0644\u0642\u0631\u0636 \u0627\u0644\u0645\u062e\u062a\u0627\u0631: ",B(I.LoanId)]})]}),O("\u062a\u0627\u0631\u064a\u062e \u062a\u0648\u0642\u064a\u0639 \u0627\u0644\u0639\u0642\u062f","ContractSigningDate","date"),O("\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0645\u0628\u0627\u0634\u0631\u0629","StartDate","date"),O("\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0646\u062c\u0627\u0632","CompleteDate","date"),O("\u0645\u062f\u0629 \u0627\u0644\u0639\u0642\u062f \u0628\u0627\u0644\u0623\u064a\u0627\u0645","DurationInDays","number"),O("\u0627\u0644\u0623\u064a\u0627\u0645 \u0627\u0644\u0645\u0636\u0627\u0641\u0629","AddedDays","number"),O("\u0645\u0628\u0644\u063a \u0627\u0644\u0639\u0642\u062f","ContractAmount","number"),(0,i.jsxs)("div",{className:"col-12 mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a"}),(0,i.jsx)("textarea",{name:"Notes",className:"form-control",rows:"3",value:I.Notes,onChange:E})]})]}),(0,i.jsxs)("div",{className:"d-flex justify-content-between mt-4",children:[(0,i.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:j,onClick:()=>{c("/contracts")},children:j?"\u062c\u0627\u0631\u064a \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638"}),(0,i.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>a(),disabled:j,children:"\u0625\u0644\u063a\u0627\u0621"})]})]})]})]})}),(0,i.jsx)(o.A,{})]})}},5150:(e,t,a)=>{a.d(t,{A:()=>c});var s=a(6213);const n=s.A.create({baseURL:"http://192.168.0.106",withCredentials:!0});let r=!1,l=[];const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;l.forEach((a=>{e?a.reject(e):a.resolve(t)})),l=[]};n.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e})),n.interceptors.response.use((e=>e),(async e=>{const t=e.config;if(t&&!t._retry&&("Access token expired"===e.message||e.response&&401===e.response.status)){if(r)return new Promise(((e,t)=>{l.push({resolve:e,reject:t})})).then((e=>(t.headers.Authorization=`Bearer ${e}`,n(t)))).catch((e=>Promise.reject(e)));t._retry=!0,r=!0;try{const e=await s.A.post("http://192.168.0.106/auth/refresh",{},{withCredentials:!0}),a=e.data.accessToken;e.data.refreshToken;return localStorage.setItem("token",a),o(null,a),t.headers.Authorization=`Bearer ${a}`,n(t)}catch(a){return o(a,null),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),window.location.href="/",Promise.reject(a)}finally{r=!1}}return Promise.reject(e)}));const c=n},6435:(e,t,a)=>{a.d(t,{A:()=>l});a(5043);var s=a(615),n=a(1932),r=a(579);function l(){const e=(0,r.jsx)(s.A,{id:"logout-tooltip",className:"custom-tooltip",children:"\u0627\u0644\u0645\u0628\u0631\u0645\u062c\u064a\u0646 : \u0645\u0635\u0637\u0641\u0649 \u0646\u062c\u0645 - \u062c\u064a\u0627\u0646 \u062d\u0633\u064a\u0646"});return(0,r.jsx)(n.A,{placement:"top",className:"custom-tooltip",overlay:e,children:(0,r.jsxs)("footer",{className:"page-footer",children:["\u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0642\u0648\u0642 \u0645\u062d\u0641\u0648\u0638\u0629 \xa9 ",(new Date).getFullYear()," \u0642\u0633\u0645 \u062a\u0642\u0646\u064a\u0629 \u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062a"]})})}},6957:(e,t,a)=>{a.d(t,{A:()=>d});var s=a(5043),n=a(3216),r=a(5475),l=a(6213),o=a(1932),c=a(615),i=a(579);function d(){const e=(0,n.Zp)(),[t,a]=(0,s.useState)(""),[d,m]=(0,s.useState)("");(0,s.useEffect)((()=>{const e=localStorage.getItem("username");e&&a(e);const t=localStorage.getItem("UserDepartment");t&&m(t)}),[]);const u=(e,t)=>(0,i.jsx)(r.k2,{to:e,className:e=>{let{isActive:t}=e;return"text-decoration-none nav-link"+(t?" active-link":"")},end:!0,"aria-current":"page",children:t});return(0,i.jsxs)("nav",{className:"bg-custom d-flex justify-content-between flex-row-reverse p-3","aria-label":"Primary navigation",children:[(0,i.jsx)("div",{className:"fs-4 fw-bold hlogo",children:(0,i.jsxs)(r.k2,{to:"/dashboard",className:"nav-brand-link",children:["\u0646\u0638\u0627\u0645 \u0627\u0644\u0645\u0646\u062d \u0648\u0627\u0644\u0642\u0631\u0648\u0636",(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"0 10px"},children:(0,i.jsx)("img",{src:"/Images/bank.png",className:"logo-shadow-rounded",alt:"",width:"50px",height:"50px"})})]})}),(0,i.jsxs)("ul",{className:"d-flex flex-row-reverse gap-3 list-unstyled mb-0 align-items-center fw-bold",children:[(0,i.jsx)("li",{children:u("/dashboard","\u0627\u0644\u0635\u0641\u062d\u0629 \u0627\u0644\u0631\u0626\u064a\u0633\u064a\u0629")}),(0,i.jsx)("li",{children:u("/contracts"," \u0627\u0644\u0639\u0642\u0648\u062f")}),(0,i.jsx)("li",{children:u("/Loans"," \u0627\u0644\u0642\u0631\u0648\u0636")}),(0,i.jsx)("li",{children:u("/RevenueList"," \u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a")}),(0,i.jsx)("li",{children:u("/AdminPanel","\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u064a\u0646")})]}),(0,i.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,i.jsx)(o.A,{placement:"bottom",overlay:(0,i.jsx)(c.A,{id:"logout-tooltip",children:"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c"}),children:(0,i.jsxs)("button",{"aria-label":"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c",className:"btn btn-outline-danger logoutB",onClick:async()=>{try{await l.A.post("http://localhost:5109/Auth/logout",{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),localStorage.removeItem("token"),localStorage.removeItem("roles"),localStorage.removeItem("username"),e("/")}catch(t){console.error("Logout failed:",t),alert("\u0641\u0634\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c\u060c \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649.")}},type:"button",children:[(0,i.jsx)("span",{className:"navbar-username",children:t.toUpperCase()}),(0,i.jsx)("img",{className:"PowImg",src:"/Images/power.gif",alt:"Power GIF",style:{borderRadius:"50%"},width:"20",height:"20"})]})}),(0,i.jsx)("h6",{className:"headingDep",children:d||"\u0644\u0627 \u064a\u0648\u062c\u062f \u0642\u0633\u0645"}),(0,i.jsx)("span",{className:"navbar-username",children:(0,i.jsx)(r.k2,{to:"/ChangePassword",className:"nav-brand-link",children:"\u062a\u063a\u064a\u064a\u0631 \u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631"})})]})]})}}}]);
//# sourceMappingURL=136.026ca6e8.chunk.js.map