"use strict";(self.webpackChunkloan_system=self.webpackChunkloan_system||[]).push([[446],{5150:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(6213);const s=n.A.create({baseURL:"http://localhost:5109",withCredentials:!0});let o=!1,l=[];const c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;l.forEach((a=>{e?a.reject(e):a.resolve(t)})),l=[]};s.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e})),s.interceptors.response.use((e=>e),(async e=>{const t=e.config;if(t&&!t._retry&&("Access token expired"===e.message||e.response&&401===e.response.status)){if(o)return new Promise(((e,t)=>{l.push({resolve:e,reject:t})})).then((e=>(t.headers.Authorization=`Bearer ${e}`,s(t)))).catch((e=>Promise.reject(e)));t._retry=!0,o=!0;try{const e=await n.A.post("http://localhost:5109/auth/refresh",{},{withCredentials:!0}),a=e.data.accessToken;e.data.refreshToken;return localStorage.setItem("token",a),c(null,a),t.headers.Authorization=`Bearer ${a}`,s(t)}catch(a){return c(a,null),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),window.location.href="/",Promise.reject(a)}finally{o=!1}}return Promise.reject(e)}));const r=s},6435:(e,t,a)=>{a.d(t,{A:()=>l});a(5043);var n=a(615),s=a(1932),o=a(579);function l(){const e=(0,o.jsx)(n.A,{id:"logout-tooltip",className:"custom-tooltip",children:"\u0627\u0644\u0645\u0628\u0631\u0645\u062c\u064a\u0646 : \u0645\u0635\u0637\u0641\u0649 \u0646\u062c\u0645 - \u062c\u064a\u0627\u0646 \u062d\u0633\u064a\u0646"});return(0,o.jsx)(s.A,{placement:"top",className:"custom-tooltip",overlay:e,children:(0,o.jsxs)("footer",{className:"page-footer",children:["\u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0642\u0648\u0642 \u0645\u062d\u0641\u0648\u0638\u0629 \xa9 ",(new Date).getFullYear()," \u0642\u0633\u0645 \u062a\u0642\u0646\u064a\u0629 \u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062a"]})})}},6876:()=>{},6957:(e,t,a)=>{a.d(t,{A:()=>d});var n=a(5043),s=a(3216),o=a(5475),l=a(6213),c=a(1932),r=a(615),i=a(579);function d(){const e=(0,s.Zp)(),[t,a]=(0,n.useState)(""),[d,h]=(0,n.useState)("");(0,n.useEffect)((()=>{const e=localStorage.getItem("username");e&&a(e);const t=localStorage.getItem("UserDepartment");t&&h(t)}),[]);const u=(e,t)=>(0,i.jsx)(o.k2,{to:e,className:e=>{let{isActive:t}=e;return"text-decoration-none nav-link"+(t?" active-link":"")},end:!0,"aria-current":"page",children:t});return(0,i.jsxs)("nav",{className:"bg-custom d-flex justify-content-between flex-row-reverse p-3","aria-label":"Primary navigation",children:[(0,i.jsx)("div",{className:"fs-4 fw-bold hlogo",children:(0,i.jsxs)(o.k2,{to:"/dashboard",className:"nav-brand-link",children:["\u0646\u0638\u0627\u0645 \u0627\u0644\u0645\u0646\u062d \u0648\u0627\u0644\u0642\u0631\u0648\u0636",(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"0 10px"},children:(0,i.jsx)("img",{src:"/Images/bank.png",className:"logo-shadow-rounded",alt:"",width:"50px",height:"50px"})})]})}),(0,i.jsxs)("ul",{className:"d-flex flex-row-reverse gap-3 list-unstyled mb-0 align-items-center fw-bold",children:[(0,i.jsx)("li",{children:u("/dashboard","\u0627\u0644\u0635\u0641\u062d\u0629 \u0627\u0644\u0631\u0626\u064a\u0633\u064a\u0629")}),(0,i.jsx)("li",{children:u("/contracts"," \u0627\u0644\u0639\u0642\u0648\u062f")}),(0,i.jsx)("li",{children:u("/Loans"," \u0627\u0644\u0642\u0631\u0648\u0636")}),(0,i.jsx)("li",{children:u("/RevenueList"," \u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a")}),(0,i.jsx)("li",{children:u("/AdminPanel","\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u064a\u0646")})]}),(0,i.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,i.jsx)(c.A,{placement:"bottom",overlay:(0,i.jsx)(r.A,{id:"logout-tooltip",children:"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c"}),children:(0,i.jsxs)("button",{"aria-label":"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c",className:"btn btn-outline-danger logoutB",onClick:async()=>{try{await l.A.post("http://localhost:5109/Auth/logout",{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),localStorage.removeItem("token"),localStorage.removeItem("roles"),localStorage.removeItem("username"),e("/")}catch(t){console.error("Logout failed:",t),alert("\u0641\u0634\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c\u060c \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649.")}},type:"button",children:[(0,i.jsx)("span",{className:"navbar-username",children:t.toUpperCase()}),(0,i.jsx)("img",{className:"PowImg",src:"/Images/power.gif",alt:"Power GIF",style:{borderRadius:"50%"},width:"20",height:"20"})]})}),(0,i.jsx)("h6",{className:"headingDep",children:d||"\u0644\u0627 \u064a\u0648\u062c\u062f \u0642\u0633\u0645"}),(0,i.jsx)("span",{className:"navbar-username",children:(0,i.jsx)(o.k2,{to:"/ChangePassword",className:"nav-brand-link",children:"\u062a\u063a\u064a\u064a\u0631 \u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631"})})]})]})}},9446:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var n=a(5043),s=a(5150),o=(a(6876),a(6957)),l=a(6435),c=a(3216),r=a(1238),i=a(2450),d=a(9067),h=a(6677),u=a(3787),m=a(8688),x=a(6711),g=a(603),p=a(579);function y(){const[e,t]=(0,n.useState)([]),[a,y]=(0,n.useState)([]),[b,j]=(0,n.useState)(""),[k,f]=(0,n.useState)(1),[v]=(0,n.useState)(10),[P,C]=(0,n.useState)(1),{loanId:A}=((0,c.Zp)(),(0,c.g)()),N={contractAmount:0,costChange:0,costPlanMins:0,costAfterChange:0,costToNatiBank:0,totalCostPaid:0,operationLoanCost:0,cashPaid:0,taxesAndBlockedmoney:0,privateMoneyPaid:0,cashExecutionPercentage:0,financialExecutionPercentage:0,materialExecutionPercentage:0,count:0},w=[{key:"contractNumber",label:"\u0631\u0642\u0645 \u0627\u0644\u0645\u0634\u0631\u0648\u0639"},{key:"contractName",label:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0634\u0631\u0648\u0639"},{key:"companyName",label:"\u0627\u0633\u0645 \u0627\u0644\u0634\u0631\u0643\u0629"},{key:"durationInDays",label:"\u0627\u0644\u0645\u062f\u0629 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629 (\u064a\u0648\u0645)"},{key:"addedDays",label:"\u0627\u0644\u0645\u062f\u0629 \u0627\u0644\u0645\u0636\u0627\u0641\u0629"},{key:"contractSigningDate",label:"\u062a\u0627\u0631\u064a\u062e \u062a\u0648\u0642\u064a\u0639 \u0627\u0644\u0639\u0642\u062f"},{key:"startDate",label:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0645\u0628\u0627\u0634\u0631\u0629"},{key:"completeDate",label:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0627\u0646\u062c\u0627\u0632 \u0639\u0644\u0649 \u0648\u0641\u0642 \u0627\u0644\u0639\u0642\u062f"},{key:"contractAmount",label:"\u0645\u0628\u0644\u063a \u0627\u0644\u0639\u0642\u062f"},{key:"costChange",label:"\u0623\u0648\u0627\u0645\u0631 \u0627\u0644\u063a\u064a\u0627\u0631"},{key:"costPlanMins",label:"\u0643\u0644\u0641 \u0627\u0644\u0627\u062f\u0631\u0627\u062c \u0628\u0648\u0632\u0627\u0631\u0629 \u0627\u0644\u062a\u062e\u0637\u064a\u0637"},{key:"costAfterChange",label:"\u0643\u0644\u0641\u0629 \u0627\u0644\u0639\u0642\u062f \u0628\u0639\u062f \u0623\u0648\u0627\u0645\u0631 \u0627\u0644\u062a\u063a\u064a\u064a\u0631"},{key:"costToNatiBank",label:"\u0627\u0644\u0645\u0631\u0641\u0648\u0639 \u0644\u0644\u0628\u0646\u0643 \u0627\u0644\u062f\u0648\u0644\u064a"},{key:"totalCostPaid",label:"\u0627\u0644\u0645\u0635\u0631\u0648\u0641 \u0627\u0644\u062a\u0631\u0627\u0643\u0645\u064a"},{key:"operationLoanCost",label:"\u0633\u0644\u0641\u0629 \u062a\u0634\u063a\u064a\u0644\u064a\u0629 (10%)"},{key:"cashPaid",label:"\u0627\u0644\u0645\u0628\u0627\u0644\u063a \u0627\u0644\u0646\u0642\u062f\u064a\u0629 \u0644\u0644\u0634\u0631\u0643\u0629"},{key:"taxesAndBlockedmoney",label:"\u0627\u0644\u062a\u0623\u0645\u064a\u0646\u0627\u062a \u0648\u0627\u0644\u0636\u0631\u0627\u0626\u0628 \u0648\u0627\u0644\u063a\u0631\u0627\u0645\u0627\u062a"},{key:"cashExecutionPercentage",label:"\u0646\u0633\u0628 \u0627\u0644\u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0646\u0642\u062f\u064a\u0629"},{key:"financialExecutionPercentage",label:"\u0646\u0633\u0628 \u0627\u0644\u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0645\u0627\u0644\u064a\u0629"},{key:"materialExecutionPercentage",label:"\u0646\u0633\u0628 \u0627\u0644\u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0645\u0627\u062f\u064a\u0629"},{key:"privateMoneyPaid",label:"\u0627\u0644\u0645\u0628\u0627\u0644\u063a \u0627\u0644\u0645\u0637\u0644\u0648\u0642\u0629 \u0645\u0646 \u0627\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u062e\u0627\u0635"},{key:"notes",label:"\u0627\u0644\u0645\u0644\u0627\u062d\u0638\u0627\u062a"}],[S,E]=(0,n.useState)(w.map((e=>e.key)));e.forEach((e=>{N.contractAmount+=e.contractAmount||0,N.costChange+=e.costChange||0,N.costPlanMins+=e.costPlanMins||0,N.costAfterChange+=e.costAfterChange||0,N.costToNatiBank+=e.costToNatiBank||0,N.totalCostPaid+=e.totalCostPaid||0,N.operationLoanCost+=e.operationLoanCost||0,N.cashPaid+=e.cashPaid||0,N.taxesAndBlockedmoney+=e.taxesAndBlockedmoney||0,N.privateMoneyPaid+=e.privateMoneyPaid||0;const t=e.totalCostPaid?e.cashPaid/e.totalCostPaid*100:0,a=e.totalCostPaid?e.costToNatiBank/e.totalCostPaid*100:0,n=e.totalCostPaid?e.costAfterChange/e.totalCostPaid*100:0;N.cashExecutionPercentage+=t,N.financialExecutionPercentage+=a,N.materialExecutionPercentage+=n,N.count+=1})),console.log("loanId from params:",A);w.map((e=>({value:e.key,label:e.label})));(0,n.useEffect)((()=>{console.log("useEffect triggered with:",{loanId:A,currentPage:k}),(e=>{if(console.log("fetchContracts called with:",{loanId:A,page:e}),!A)return void console.log("No loanId provided, exiting fetchContracts");const a=`/Contracts/GetAllContractsByLoan?LoanId=${A}&page=${e}&pageSize=${v}`;s.A.get(a).then((e=>{t(e.data),C(1),j("")})).catch((e=>{var t;401===(null===(t=e.response)||void 0===t?void 0:t.status)?j("Unauthorized \u2013 please login."):j("Error fetching contracts.")}))})(k),(async()=>{try{var e;const t=await s.A.get("/Loan/GetAllLoans");console.log("Loans response:",t.data),y((null===(e=t.data)||void 0===e?void 0:e.loans)||[])}catch(t){console.error("Error fetching loans:",t)}})()}),[A,k]);const I=e=>{e>0&&e<=P&&f(e)};return console.log("Current state:",{contracts:e,contractsLength:e.length}),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(o.A,{}),(0,p.jsxs)("div",{className:"container my-5",style:{direction:"rtl"},children:[(0,p.jsx)("div",{style:{width:"100%"},className:"d-flex justify-content-between align-items-center mb-4",children:(0,p.jsx)("h2",{className:"text-primary",children:"\u062a\u0642\u0631\u064a\u0631 "})}),(0,p.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[(0,p.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start"},children:[(0,p.jsx)(d.A,{children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0623\u0639\u0645\u062f\u0629"}),(0,p.jsx)(h.A,{style:{width:"400px"},className:"p-2",children:(0,p.jsx)(u.A,{multiple:!0,value:S,onChange:e=>E(e.target.value),renderValue:e=>w.filter((t=>e.includes(t.key))).map((e=>e.label)).join(", "),children:w.map((e=>(0,p.jsxs)(m.A,{value:e.key,children:[(0,p.jsx)(x.A,{checked:S.includes(e.key)}),(0,p.jsx)(g.A,{primary:e.label})]},e.key)))})})]}),b&&(0,p.jsx)("div",{className:"text-danger mb-3",children:b}),(0,p.jsx)("button",{onClick:()=>{const e=document.getElementById("projects-table");if(!e)return;const t=r.Wp.table_to_sheet(e,{raw:!0}),a=r.Wp.book_new();r.Wp.book_append_sheet(a,t,"Projects");const n=r.M9(a,{bookType:"xlsx",type:"array"}),s=new Blob([n],{type:"application/octet-stream"});(0,i.saveAs)(s,"projects.xlsx")},className:"btn btn-success mb-3",children:"\u062a\u0635\u062f\u064a\u0631 \u0625\u0644\u0649 Excel"}),(0,p.jsx)("button",{onClick:()=>{window.print()},className:"btn btn-secondary mb-3 mx-3",children:"\u0637\u0628\u0627\u0639\u0629 \u0627\u0644\u062a\u0642\u0631\u064a\u0631"})]}),(0,p.jsx)("div",{className:"table-responsive",id:"print-area",children:(0,p.jsxs)("table",{className:"table table-bordered table-hover text-center align-middle",id:"projects-table",children:[(0,p.jsx)("thead",{className:"table-light",children:(0,p.jsx)("tr",{children:w.filter((e=>S.includes(e.key))).map((e=>(0,p.jsx)("th",{children:e.label},e.key)))})}),(0,p.jsxs)("tbody",{children:[0===e.length?(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:"23",className:"text-center",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a"})}):e.map((e=>(0,p.jsx)("tr",{children:w.filter((e=>S.includes(e.key))).map((t=>{var a;let n=e[t.key];if(["contractSigningDate","startDate","completeDate"].includes(t.key)&&(n=n?n.slice(0,10):"-"),["cashExecutionPercentage","financialExecutionPercentage","materialExecutionPercentage"].includes(t.key)){const a="cashExecutionPercentage"===t.key?e.cashPaid:"financialExecutionPercentage"===t.key?e.costToNatiBank:e.costAfterChange;n=e.totalCostPaid>0?`%${(a/e.totalCostPaid*100).toFixed(1)}`:"0%"}return(0,p.jsx)("td",{children:null!==(a=n)&&void 0!==a?a:"-"},t.key)}))},e.Id))),(0,p.jsxs)("tr",{className:"table-secondary fw-bold",children:[(0,p.jsx)("td",{colSpan:"8",className:"text-end",children:"\u0627\u0644\u0645\u062c\u0645\u0648\u0639"}),(0,p.jsx)("td",{children:N.contractAmount.toLocaleString()}),(0,p.jsx)("td",{children:N.costChange.toLocaleString()}),(0,p.jsx)("td",{children:N.costPlanMins.toLocaleString()}),(0,p.jsx)("td",{children:N.costAfterChange.toLocaleString()}),(0,p.jsx)("td",{children:N.costToNatiBank.toLocaleString()}),(0,p.jsx)("td",{children:N.totalCostPaid.toLocaleString()}),(0,p.jsx)("td",{children:N.operationLoanCost.toLocaleString()}),(0,p.jsx)("td",{children:N.cashPaid.toLocaleString()}),(0,p.jsx)("td",{children:N.taxesAndBlockedmoney.toLocaleString()}),(0,p.jsx)("td",{children:N.count?(N.cashExecutionPercentage/N.count).toFixed(2)+"%":"0%"}),(0,p.jsx)("td",{children:N.count?(N.financialExecutionPercentage/N.count).toFixed(2)+"%":"0%"}),(0,p.jsx)("td",{children:N.count?(N.materialExecutionPercentage/N.count).toFixed(2)+"%":"0%"}),(0,p.jsx)("td",{children:N.privateMoneyPaid.toLocaleString()}),(0,p.jsx)("td",{})]})]})]})}),(0,p.jsxs)("div",{className:"d-flex justify-content-center my-4 gap-3",children:[(0,p.jsx)("button",{className:"btn btn-outline-primary",onClick:()=>I(k-1),disabled:1===k,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,p.jsxs)("span",{className:"align-self-center",children:["\u0627\u0644\u0635\u0641\u062d\u0629 ",k," \u0645\u0646 ",P]}),(0,p.jsx)("button",{className:"btn btn-outline-primary",onClick:()=>I(k+1),disabled:k===P,children:"\u0627\u0644\u062a\u0627\u0644\u064a"})]})]}),(0,p.jsx)(l.A,{})]})}}}]);
//# sourceMappingURL=446.01600989.chunk.js.map