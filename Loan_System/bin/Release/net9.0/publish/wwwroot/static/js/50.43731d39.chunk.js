"use strict";(self.webpackChunkloan_system=self.webpackChunkloan_system||[]).push([[50],{3050:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var s=a(5043),r=a(5150),n=(a(6876),a(6957)),l=a(6435),o=a(1238),c=a(2450),i=a(579);function d(){const[e,t]=(0,s.useState)(""),[a,d]=(0,s.useState)(""),[h,m]=(0,s.useState)([]),[u,x]=(0,s.useState)([]),[g,p]=(0,s.useState)([]),[b,v]=(0,s.useState)(""),[f,y]=(0,s.useState)(!1),[j,N]=(0,s.useState)("");(0,s.useEffect)((()=>{const e=new Date;d(e.getMonth()+1),t(e.getFullYear()),A()}),[]);const A=async()=>{try{N("");const e=await r.A.get("/RevenuInfo/GetAllRevenues");let t=[];e.data&&Array.isArray(e.data.loans)?t=e.data.loans:e.data&&Array.isArray(e.data.Loans)?t=e.data.Loans:Array.isArray(e.data)&&(t=e.data),console.log("Processed revenue info:",t),p(t),0===t.length&&N("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0644\u0639\u062b\u0648\u0631 \u0639\u0644\u0649 \u0623\u064a \u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0641\u064a \u0627\u0644\u0646\u0638\u0627\u0645")}catch(a){var e,t;console.error("Error fetching revenue info:",a),N(`\u062e\u0637\u0623 \u0641\u064a \u062c\u0644\u0628 \u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a: ${(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message}`),p([])}},w=(e,t)=>t.reduce(((t,a)=>{var s;if((null===(s=a.revenueInfo)||void 0===s?void 0:s.id)===e||a.revenueId===e){const e=parseFloat(a.revenueCost||0);return t+(isNaN(e)?0:e)}return t}),0),k=e=>u&&0!==u.length?u.reduce(((t,a)=>{var s;if((null===(s=a.revenueInfo)||void 0===s?void 0:s.id)===e||a.revenueId===e){const e=parseFloat(a.revenueCost||0);return t+(isNaN(e)?0:e)}return t}),0):0,S=e=>["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"][parseInt(e)-1]||e,I=e=>{const t=parseFloat(e||0);return isNaN(t)?"0":t.toLocaleString()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A,{}),(0,i.jsxs)("div",{className:"container my-5",style:{direction:"rtl"},children:[(0,i.jsx)("h2",{className:"text-primary mb-4",children:"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a"}),b&&(0,i.jsx)("div",{className:"alert alert-danger",children:b}),j&&(0,i.jsx)("div",{className:"alert alert-warning",children:j}),(0,i.jsxs)("div",{className:"row g-3 align-items-center mb-4",children:[(0,i.jsxs)("div",{className:"col-auto",children:[(0,i.jsx)("label",{className:"form-label",children:"\u0627\u0644\u0634\u0647\u0631:"}),(0,i.jsxs)("select",{className:"form-select",value:a,onChange:e=>d(e.target.value),disabled:f,children:[(0,i.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0634\u0647\u0631"}),[...Array(12)].map(((e,t)=>(0,i.jsxs)("option",{value:t+1,children:[t+1," - ",S(t+1)]},t+1)))]})]}),(0,i.jsxs)("div",{className:"col-auto",children:[(0,i.jsx)("label",{className:"form-label",children:"\u0627\u0644\u0633\u0646\u0629:"}),(0,i.jsx)("input",{type:"number",className:"form-control",value:e,onChange:e=>t(e.target.value),placeholder:"2025",min:"2020",max:"2030",disabled:f})]}),(0,i.jsx)("div",{className:"col-auto",children:(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>{(async()=>{if(e&&a){y(!0),v("");try{const t=`/BudgetRevenue/GetReportByDateAndDep?year=${e}&month=${a}`;console.log("Fetching revenues from:",t);const s=await r.A.get(t);console.log("Revenues API Response:",s.data);let n=[];if(Array.isArray(s.data))n=s.data;else if(s.data&&Array.isArray(s.data.revenues))n=s.data.revenues;else if(s.data&&Array.isArray(s.data.data))n=s.data.data;else if(s.data&&"object"===typeof s.data){const e=Object.keys(s.data).find((e=>Array.isArray(s.data[e])));e&&(n=s.data[e])}console.log("Processed revenues data:",n),m(n)}catch(l){var t,s,n;console.error("Error fetching revenues:",l),404===(null===(t=l.response)||void 0===t?void 0:t.status)?(m([]),v("\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062d\u062f\u062f\u0629.")):v(`\u0641\u0634\u0644 \u0641\u064a \u062c\u0644\u0628 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a: ${(null===(s=l.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||l.message}`)}finally{y(!1)}}else v("\u064a\u0631\u062c\u0649 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0634\u0647\u0631 \u0648\u0627\u0644\u0633\u0646\u0629.")})(),(async()=>{if(!e||!a)return void v("\u064a\u0631\u062c\u0649 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0634\u0647\u0631 \u0648\u0627\u0644\u0633\u0646\u0629.");let t,s;1===a?(t=12,s=e-1):(t=a-1,s=e),y(!0),v("");try{const e=`/BudgetRevenue/GetReportByDateAndDep?year=${s}&month=${t}`;console.log("Fetching previous month revenues from:",e);const a=await r.A.get(e);console.log("Previous month API Response:",a.data);let n=[];if(Array.isArray(a.data))n=a.data;else if(a.data&&Array.isArray(a.data.revenues))n=a.data.revenues;else if(a.data&&Array.isArray(a.data.data))n=a.data.data;else if(a.data&&"object"===typeof a.data){const e=Object.keys(a.data).find((e=>Array.isArray(a.data[e])));e&&(n=a.data[e])}console.log("Processed previous month data:",n),x(n)}catch(c){var n,l,o;console.error("Error fetching previous month revenues:",c),404===(null===(n=c.response)||void 0===n?void 0:n.status)?x([]):v(`\u0641\u0634\u0644 \u0641\u064a \u062c\u0644\u0628 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u0633\u0627\u0628\u0642: ${(null===(l=c.response)||void 0===l||null===(o=l.data)||void 0===o?void 0:o.message)||c.message}`)}finally{y(!1)}})()},disabled:f||!e||!a,children:f?"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644...":"\u0639\u0631\u0636 \u0627\u0644\u062a\u0642\u0631\u064a\u0631"})}),(0,i.jsxs)("div",{className:"col-auto",children:[(0,i.jsx)("button",{className:"btn btn-success",onClick:()=>{const t=[...new Map(g.map((e=>[e.id,e]))).values()];if(0!==t.length)try{const s=[];t.forEach((e=>{const t=w(e.id,h),a=k(e.id),r=t+a;s.push({"\u0627\u0644\u0641\u0635\u0644":e.section||"","\u0627\u0644\u0645\u0627\u062f\u0629":e.chapter||"","\u0627\u0644\u0646\u0648\u0639":e.type||"","\u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644":e.typeDetails||"","\u0627\u0633\u0645 \u0627\u0644\u0625\u064a\u0631\u0627\u062f":e.revenueName||"","\u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u0633\u0627\u0628\u0642":a,"\u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u062d\u0627\u0644\u064a":t,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639":r})}));const r=o.Wp.json_to_sheet(s),n=o.Wp.book_new();o.Wp.book_append_sheet(n,r,"Revenues");const l=o.M9(n,{bookType:"xlsx",type:"array"}),i=new Blob([l],{type:"application/octet-stream"});(0,c.saveAs)(i,`revenue-report-${e}-${String(a).padStart(2,"0")}.xlsx`)}catch(s){console.error("Error exporting to Excel:",s),alert(`\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${s.message}`)}else alert("\u0644\u0627 \u062a\u0648\u062c\u062f \u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0644\u0644\u062a\u0635\u062f\u064a\u0631")},disabled:f||0===g.length,children:"\u062a\u0635\u062f\u064a\u0631 Excel"}),(0,i.jsx)("button",{onClick:()=>{const t=document.getElementById("print-area");if(!t)return;const s=window.open("","_blank"),r=t.innerHTML;s.document.write(`\n          <html>\n            <head>\n              <title>\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a</title>\n              <style>\n                body { font-family: Arial, sans-serif; direction: rtl; margin: 20px; }\n                table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }\n                th, td { border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 12px; }\n                th { background-color: #f2f2f2; font-weight: bold; }\n                .table-dark th { background-color: #343a40; color: white; }\n                .table-warning { background-color: #fff3cd; }\n                .table-success { background-color: #d1edff; }\n                .table-info { background-color: #d1ecf1; }\n                .badge { padding: 4px 8px; border-radius: 4px; font-size: 10px; }\n                .bg-success { background-color: #28a745; color: white; }\n                .bg-warning { background-color: #ffc107; color: black; }\n                .bg-info { background-color: #17a2b8; color: white; }\n                .bg-secondary { background-color: #6c757d; color: white; }\n                .text-dark { color: black; }\n                @media print {\n                body { margin: 0; }\n                table { page-break-inside: avoid; }\n                }\n            </style>\n            </head>\n            <body>\n            <div style="display:flex; justify-content:space-between; align-items:center">\n                        <h3 style="text-align: center; margin-bottom: 30px;">\u0648\u0632\u0627\u0631\u0629 \u0627\u0644\u0645\u0648\u0627\u0631\u062f \u0627\u0644\u0645\u0627\u0626\u064a\u0629 <br> \u0645\u0631\u0643\u0632 \u0627\u0644\u0648\u0632\u0627\u0631\u0629 <br> \u062f\u0627\u0626\u0631\u0629 \u0627\u0644\u0634\u0624\u0624\u0646 \u0627\u0644\u0645\u0627\u0644\u064a\u0629 - \u0627\u0644\u0645\u064a\u0632\u0627\u0646\u064a\u0629 </h3>\n\n            <h2 style="text-align: center; margin-bottom: 30px;">\u062c\u062f\u0648\u0644 \u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a \u0644\u0634\u0647\u0631 ${S(a)}  ${e}</h2>\n            <h2 style="text-align: center; margin-bottom: 30px;"></h2>\n\n              </div>\n              ${r}\n            </body>\n          </html>\n        `),s.document.close(),s.print()},className:"btn btn-secondary mb-3 mx-3",children:"\u0637\u0628\u0627\u0639\u0629 \u0627\u0644\u062a\u0642\u0631\u064a\u0631"})]})]}),f?(0,i.jsx)("div",{className:"d-flex justify-content-center my-5",children:(0,i.jsx)("div",{className:"spinner-border",role:"status",children:(0,i.jsx)("span",{className:"visually-hidden",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."})})}):e&&a?0!==g.length||j?(0,i.jsx)("div",{className:"revenue-report",children:(0,i.jsxs)("div",{className:"card mt-4",children:[(0,i.jsx)("div",{className:"card-header bg-primary text-white",children:(0,i.jsxs)("h5",{className:"mb-0",children:["\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a - ",S(a)," ",e]})}),(0,i.jsx)("div",{className:"card-body p-0",children:(0,i.jsx)("div",{className:"table-responsive",id:"print-area",children:(0,i.jsxs)("table",{className:"table table-striped table-hover mb-0",children:[(0,i.jsx)("thead",{className:"table-dark",children:(0,i.jsxs)("tr",{style:{fontSize:"12px"},children:[(0,i.jsx)("th",{className:"text-center",children:"\u0627\u0644\u0641\u0635\u0644"}),(0,i.jsx)("th",{className:"text-center",children:"\u0627\u0644\u0645\u0627\u062f\u0629"}),(0,i.jsx)("th",{className:"text-center",children:"\u0627\u0644\u0646\u0648\u0639"}),(0,i.jsx)("th",{className:"text-center",children:"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0646\u0648\u0639"}),(0,i.jsx)("th",{className:"text-center",children:"\u0627\u0633\u0645 \u0627\u0644\u0625\u064a\u0631\u0627\u062f"}),(0,i.jsx)("th",{className:"text-center",children:"\u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u0633\u0627\u0628\u0642"}),(0,i.jsx)("th",{className:"text-center",children:"\u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u062d\u0627\u0644\u064a"}),(0,i.jsx)("th",{className:"text-center",children:"\u0627\u0644\u0645\u062c\u0645\u0648\u0639"})]})}),(0,i.jsx)("tbody",{children:[...new Map(g.map((e=>[e.id,e]))).values()].map((e=>{const t=w(e.id,h),a=k(e.id),s=t+a;return(0,i.jsxs)("tr",{style:{fontSize:"12px"},children:[(0,i.jsx)("td",{className:"text-center fw-bold",children:e.section||""}),(0,i.jsx)("td",{className:"text-center fw-bold",children:e.chapter||""}),(0,i.jsx)("td",{className:"text-center fw-bold",children:e.type||""}),(0,i.jsx)("td",{className:"text-center fw-bold",children:e.typeDetails||""}),(0,i.jsx)("td",{className:"text-center fw-bold",children:e.revenueName||""}),(0,i.jsx)("td",{className:"text-center",children:(0,i.jsx)("span",{className:"badge bg-warning text-dark fs-6",children:I(a)})}),(0,i.jsx)("td",{className:"text-center",children:(0,i.jsx)("span",{className:"badge bg-info fs-6",children:I(t)})}),(0,i.jsx)("td",{className:"text-center",children:(0,i.jsx)("span",{className:"badge bg-success fs-6",children:I(s)})})]},e.id)}))})]})})})]})}):(0,i.jsxs)("div",{className:"alert alert-warning text-center",children:["\u0644\u0627 \u062a\u0648\u062c\u062f \u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0645\u0633\u062c\u0644\u0629 \u0641\u064a \u0627\u0644\u0646\u0638\u0627\u0645",(0,i.jsx)("br",{}),(0,i.jsx)("button",{className:"btn btn-sm btn-outline-primary mt-2",onClick:A,children:"\u0625\u0639\u0627\u062f\u0629 \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629"})]}):(0,i.jsx)("div",{className:"alert alert-info text-center",children:"\u064a\u0631\u062c\u0649 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0634\u0647\u0631 \u0648\u0627\u0644\u0633\u0646\u0629 \u0644\u0639\u0631\u0636 \u0627\u0644\u062a\u0642\u0631\u064a\u0631"})]}),(0,i.jsx)(l.A,{})]})}},5150:(e,t,a)=>{a.d(t,{A:()=>c});var s=a(6213);const r=s.A.create({baseURL:"http://192.168.0.106",withCredentials:!0});let n=!1,l=[];const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;l.forEach((a=>{e?a.reject(e):a.resolve(t)})),l=[]};r.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e})),r.interceptors.response.use((e=>e),(async e=>{const t=e.config;if(t&&!t._retry&&("Access token expired"===e.message||e.response&&401===e.response.status)){if(n)return new Promise(((e,t)=>{l.push({resolve:e,reject:t})})).then((e=>(t.headers.Authorization=`Bearer ${e}`,r(t)))).catch((e=>Promise.reject(e)));t._retry=!0,n=!0;try{const e=await s.A.post("http://192.168.0.106/auth/refresh",{},{withCredentials:!0}),a=e.data.accessToken;e.data.refreshToken;return localStorage.setItem("token",a),o(null,a),t.headers.Authorization=`Bearer ${a}`,r(t)}catch(a){return o(a,null),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),window.location.href="/",Promise.reject(a)}finally{n=!1}}return Promise.reject(e)}));const c=r},6435:(e,t,a)=>{a.d(t,{A:()=>l});a(5043);var s=a(615),r=a(1932),n=a(579);function l(){const e=(0,n.jsx)(s.A,{id:"logout-tooltip",className:"custom-tooltip",children:"\u0627\u0644\u0645\u0628\u0631\u0645\u062c\u064a\u0646 : \u0645\u0635\u0637\u0641\u0649 \u0646\u062c\u0645 - \u062c\u064a\u0627\u0646 \u062d\u0633\u064a\u0646"});return(0,n.jsx)(r.A,{placement:"top",className:"custom-tooltip",overlay:e,children:(0,n.jsxs)("footer",{className:"page-footer",children:["\u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0642\u0648\u0642 \u0645\u062d\u0641\u0648\u0638\u0629 \xa9 ",(new Date).getFullYear()," \u0642\u0633\u0645 \u062a\u0642\u0646\u064a\u0629 \u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062a"]})})}},6876:()=>{},6957:(e,t,a)=>{a.d(t,{A:()=>d});var s=a(5043),r=a(3216),n=a(5475),l=a(6213),o=a(1932),c=a(615),i=a(579);function d(){const e=(0,r.Zp)(),[t,a]=(0,s.useState)(""),[d,h]=(0,s.useState)("");(0,s.useEffect)((()=>{const e=localStorage.getItem("username");e&&a(e);const t=localStorage.getItem("UserDepartment");t&&h(t)}),[]);const m=(e,t)=>(0,i.jsx)(n.k2,{to:e,className:e=>{let{isActive:t}=e;return"text-decoration-none nav-link"+(t?" active-link":"")},end:!0,"aria-current":"page",children:t});return(0,i.jsxs)("nav",{className:"bg-custom d-flex justify-content-between flex-row-reverse p-3","aria-label":"Primary navigation",children:[(0,i.jsx)("div",{className:"fs-4 fw-bold hlogo",children:(0,i.jsxs)(n.k2,{to:"/dashboard",className:"nav-brand-link",children:["\u0646\u0638\u0627\u0645 \u0627\u0644\u0645\u0646\u062d \u0648\u0627\u0644\u0642\u0631\u0648\u0636",(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"0 10px"},children:(0,i.jsx)("img",{src:"/Images/bank.png",className:"logo-shadow-rounded",alt:"",width:"50px",height:"50px"})})]})}),(0,i.jsxs)("ul",{className:"d-flex flex-row-reverse gap-3 list-unstyled mb-0 align-items-center fw-bold",children:[(0,i.jsx)("li",{children:m("/dashboard","\u0627\u0644\u0635\u0641\u062d\u0629 \u0627\u0644\u0631\u0626\u064a\u0633\u064a\u0629")}),(0,i.jsx)("li",{children:m("/contracts"," \u0627\u0644\u0639\u0642\u0648\u062f")}),(0,i.jsx)("li",{children:m("/Loans"," \u0627\u0644\u0642\u0631\u0648\u0636")}),(0,i.jsx)("li",{children:m("/RevenueList"," \u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a")}),(0,i.jsx)("li",{children:m("/AdminPanel","\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u064a\u0646")})]}),(0,i.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,i.jsx)(o.A,{placement:"bottom",overlay:(0,i.jsx)(c.A,{id:"logout-tooltip",children:"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c"}),children:(0,i.jsxs)("button",{"aria-label":"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c",className:"btn btn-outline-danger logoutB",onClick:async()=>{try{await l.A.post("http://localhost:5109/Auth/logout",{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),localStorage.removeItem("token"),localStorage.removeItem("roles"),localStorage.removeItem("username"),e("/")}catch(t){console.error("Logout failed:",t),alert("\u0641\u0634\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c\u060c \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649.")}},type:"button",children:[(0,i.jsx)("span",{className:"navbar-username",children:t.toUpperCase()}),(0,i.jsx)("img",{className:"PowImg",src:"/Images/power.gif",alt:"Power GIF",style:{borderRadius:"50%"},width:"20",height:"20"})]})}),(0,i.jsx)("h6",{className:"headingDep",children:d||"\u0644\u0627 \u064a\u0648\u062c\u062f \u0642\u0633\u0645"}),(0,i.jsx)("span",{className:"navbar-username",children:(0,i.jsx)(n.k2,{to:"/ChangePassword",className:"nav-brand-link",children:"\u062a\u063a\u064a\u064a\u0631 \u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631"})})]})]})}}}]);
//# sourceMappingURL=50.43731d39.chunk.js.map