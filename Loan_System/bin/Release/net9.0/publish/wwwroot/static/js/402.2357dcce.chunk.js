"use strict";(self.webpackChunkloan_system=self.webpackChunkloan_system||[]).push([[402,491],{562:()=>{},3402:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(5043),n=s(5150),r=s(6957),l=s(6435),o=(s(562),s(7488)),c=s(579);function i(){const[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)({}),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(""),[g,p]=(0,a.useState)(""),[v,x]=(0,a.useState)(""),[f,j]=(0,a.useState)((new Date).getFullYear()),[N,y]=(0,a.useState)((new Date).getMonth()+1),[b,S]=(0,a.useState)(""),w=e=>{let{title:t,description:s,type:a="info"}=e;(0,o.oR)((0,c.jsxs)("div",{children:[(0,c.jsx)("strong",{children:t}),(0,c.jsx)("div",{children:s})]}),{position:"top-right",autoClose:5e3,type:a})};(0,a.useEffect)((()=>{const e=localStorage.getItem("UserDepartment");console.log("Department from localStorage:",e),e?h(e):p("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0644\u0639\u062b\u0648\u0631 \u0639\u0644\u0649 \u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0642\u0633\u0645")}),[]),(0,a.useEffect)((()=>{!async function(){try{u(!0),console.log("Fetching revenues...");const e=await n.A.get("/RevenuInfo/GetAllRevenues");console.log("Raw response:",e),console.log("Response data:",e.data);let s=[];e.data.loans?s=e.data.loans:e.data.revenues?s=e.data.revenues:Array.isArray(e.data)&&(s=e.data),console.log("Processed revenue data:",s),t(s)}catch(e){console.error("Error fetching revenues:",e),p("\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a")}finally{u(!1)}}()}),[]);const A=(e,t)=>{console.log(`Changing revenue ${e} to value:`,t),i((s=>({...s,[e]:t})))},I=async(e,t,s,a)=>{try{return(await n.A.get("/BudgetRevenue/CheckExisting",{params:{revenueId:e,department:t,year:s,month:a}})).data.exists}catch(g){return console.error("Error checking existing entry:",g),!1}};return(0,c.jsxs)("div",{className:"d-flex flex-column min-vh-100",children:[(0,c.jsx)(r.A,{}),(0,c.jsx)("main",{className:"flex-fill container my-4",children:(0,c.jsxs)("div",{className:"contract-form-container",children:[(0,c.jsxs)("h2",{children:["\u0625\u0636\u0627\u0641\u0629 \u062a\u0643\u0627\u0644\u064a\u0641 \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0644\u0642\u0633\u0645 ",m]}),g&&(0,c.jsxs)("div",{className:"alert alert-danger",children:[(0,c.jsx)("strong",{children:g}),b&&(0,c.jsx)("pre",{className:"mt-2",style:{fontSize:"12px"},children:b})]}),v&&(0,c.jsx)("div",{className:"alert alert-success",children:v}),(0,c.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),u(!0),p(""),x(""),S(""),console.log("=== FORM SUBMISSION DEBUG ==="),console.log("Form data:",s),console.log("Department:",m),console.log("Year:",f,typeof f),console.log("Month:",N,typeof N),console.log("Revenues:",e);try{const t=[],r=[];for(const c of e){const e=s[c.id];if(null!=e&&""!==e){if(await I(c.id,null===m||void 0===m?void 0:m.trim(),f,N)){r.push(c.revenueName),t.push({revenue:c.revenueName,status:"duplicate",response:"\u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0645\u0648\u062c\u0648\u062f\u0629 \u0645\u0633\u0628\u0642\u0627\u064b"});continue}const s={RevenueId:parseInt(c.id),Department:(null===m||void 0===m?void 0:m.trim())||"",RevenueCost:parseFloat(e),Year:parseInt(f),Month:parseInt(N),Notes:"\u062a\u0645\u062a \u0627\u0644\u0625\u0636\u0627\u0641\u0629 \u0645\u0646 \u0627\u0644\u0648\u0627\u062c\u0647\u0629"};console.log(`\n--- Submitting for ${c.revenueName} ---`),console.log("Submission data:",s);try{const e=await n.A.post("/BudgetRevenue/AddRevenueCost",s);console.log("\u2705 Success:",e.data),t.push({revenue:c.revenueName,status:"success",response:e.data})}catch(g){var a;console.error("\u274c Error:",g),t.push({revenue:c.revenueName,status:"error",response:(null===(a=g.response)||void 0===a?void 0:a.data)||g.message})}}}console.log("=== SUBMISSION SUMMARY ==="),console.log("All submissions:",t);const l=t.filter((e=>"success"===e.status)),o=t.filter((e=>"error"===e.status));if(l.length>0&&0===o.length)x("\u062a\u0645\u062a \u0625\u0636\u0627\u0641\u0629 \u062a\u0643\u0627\u0644\u064a\u0641 \u0628\u0646\u062c\u0627\u062d!"),i({}),w({title:"\u062a\u0645\u062a \u0627\u0644\u0639\u0645\u0644\u064a\u0629 \u0628\u0646\u062c\u0627\u062d",description:"\u062a\u0645\u062a \u0625\u0636\u0627\u0641\u0629 \u062c\u0645\u064a\u0639 \u0627\u0644\u062a\u0643\u0627\u0644\u064a\u0641 \u0628\u0646\u062c\u0627\u062d )",type:"success"});else if(l.length>0&&o.length>0){const e=o.map((e=>`${e.revenue}: ${JSON.stringify(e.response)}`)).join("\n");p(`\u062a\u0645\u062a \u0625\u0636\u0627\u0641\u0629 ${l.length} \u062a\u0643\u0627\u0644\u064a\u0641\u060c \u0648\u0641\u0634\u0644 ${o.length} \u062a\u0643\u0627\u0644\u064a\u0641`),S(`\u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644:\n${e}`),w({title:"\u062a\u0645\u062a \u0627\u0644\u0639\u0645\u0644\u064a\u0629 \u062c\u0632\u0626\u064a\u0627\u064b",description:`\u062a\u0645\u062a \u0625\u0636\u0627\u0641\u0629 ${l.length} \u062a\u0643\u0627\u0644\u064a\u0641 \u0628\u0646\u062c\u0627\u062d\u060c \u0648\u0641\u0634\u0644 ${o.length} \u062a\u0643\u0627\u0644\u064a\u0641`,type:"warning"})}else if(o.length>0){const e=o.map((e=>`${e.revenue}: ${JSON.stringify(e.response)}`)).join("\n");p(`\u0641\u0634\u0644 \u0641\u064a \u062d\u0641\u0638 \u062c\u0645\u064a\u0639 \u0627\u0644\u062a\u0643\u0627\u0644\u064a\u0641 (${o.length} \u0639\u0646\u0635\u0631)`),S(`\u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644:\n${e}`),w({title:"\u0641\u0634\u0644\u062a \u0627\u0644\u0639\u0645\u0644\u064a\u0629",description:`\u0641\u0634\u0644 \u0641\u064a \u062d\u0641\u0638 \u062c\u0645\u064a\u0639 \u0627\u0644\u062a\u0643\u0627\u0644\u064a\u0641 (${o.length} \u0639\u0646\u0635\u0631)`,type:"error"})}else w({title:"\u062a\u0646\u0628\u064a\u0647",description:"\u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a \u0644\u0647\u0630\u0627 \u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0645\u062f\u062e\u0644\u0629 \u0645\u0633\u0628\u0642\u0627",type:"info"})}catch(r){console.error("General error:",r),p("\u062e\u0637\u0623 \u0639\u0627\u0645 \u0641\u064a \u0627\u0644\u0625\u0631\u0633\u0627\u0644"),S(r.message),w({title:"\u062e\u0637\u0623 \u0639\u0627\u0645",description:"\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639 \u0623\u062b\u0646\u0627\u0621 \u0627\u0644\u0625\u0631\u0633\u0627\u0644",type:"error"})}finally{u(!1)}},className:"row g-3",children:[(0,c.jsxs)("div",{className:"col-md-3",children:[(0,c.jsx)("label",{className:"form-label",children:"\u0627\u0644\u0633\u0646\u0629"}),(0,c.jsx)("input",{type:"number",className:"form-control",min:"2000",max:"2100",step:"1",value:f,onChange:e=>{const t=parseInt(e.target.value);console.log("Year changed to:",t,typeof t),j(t)},placeholder:"\u0623\u062f\u062e\u0644 \u0627\u0644\u0633\u0646\u0629",required:!0})]}),(0,c.jsxs)("div",{className:"col-md-3",children:[(0,c.jsx)("label",{className:"form-label",children:"\u0627\u0644\u0634\u0647\u0631"}),(0,c.jsx)("select",{className:"form-select",value:N,onChange:e=>{const t=parseInt(e.target.value);console.log("Month changed to:",t,typeof t),y(t)},required:!0,children:["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"].map(((e,t)=>(0,c.jsx)("option",{value:t+1,children:e},t+1)))})]}),(0,c.jsxs)("div",{className:"col-md-6",children:[(0,c.jsx)("label",{className:"form-label",children:"\u0627\u0644\u0642\u0633\u0645"}),(0,c.jsx)("input",{readOnly:!0,type:"text",className:"form-control",value:m,onChange:e=>{console.log("Department changed to:",e.target.value),h(e.target.value)},placeholder:"\u0627\u0633\u0645 \u0627\u0644\u0642\u0633\u0645",required:!0})]}),(0,c.jsx)("hr",{}),(0,c.jsx)("h5",{className:"mt-2 text-center font-bold",children:"\u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u062a\u0634\u063a\u064a\u0644\u064a\u0629"}),(0,c.jsx)("div",{className:"row",children:e.filter((e=>"\u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u0627\u0633\u062a\u062b\u0645\u0627\u0631\u064a\u0629"!==e.revenueName)).map((e=>(0,c.jsxs)("div",{className:"col-md-6",children:[(0,c.jsx)("label",{className:"form-label",children:e.revenueName}),(0,c.jsx)("input",{type:"number",className:"form-control",step:"0.01",value:s[e.id]||"",onChange:t=>{console.log(`Revenue ${e.id} (${e.revenueName}) changed to:`,t.target.value),A(e.id,t.target.value)},placeholder:"\u0623\u062f\u062e\u0644 \u0642\u064a\u0645\u0629 \u0627\u0644\u062a\u0643\u0644\u0641\u0629"})]},e.id)))}),(0,c.jsx)("hr",{}),(0,c.jsx)("h5",{className:"mt-4 text-center font-bold",children:"\u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u0627\u0633\u062a\u062b\u0645\u0627\u0631\u064a\u0629"}),(0,c.jsx)("div",{className:"row",children:e.filter((e=>"\u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u0627\u0633\u062a\u062b\u0645\u0627\u0631\u064a\u0629"===e.revenueName)).map((e=>(0,c.jsxs)("div",{className:"col-md-6",children:[(0,c.jsx)("label",{className:"form-label",children:e.revenueName}),(0,c.jsx)("input",{type:"number",className:"form-control",step:"0.01",value:s[e.id]||"",onChange:t=>{console.log(`Revenue ${e.id} (${e.revenueName}) changed to:`,t.target.value),A(e.id,t.target.value)},placeholder:"\u0623\u062f\u062e\u0644 \u0642\u064a\u0645\u0629 \u0627\u0644\u062a\u0643\u0644\u0641\u0629"})]},e.id)))}),(0,c.jsx)("div",{className:"col-12",children:(0,c.jsx)("button",{type:"submit",className:"btn btn-success",disabled:d||0===e.length,children:d?"\u062c\u0627\u0631\u064d \u0627\u0644\u0625\u0636\u0627\u0641\u0629...":"\u062d\u0641\u0638 \u0627\u0644\u062a\u0643\u0627\u0644\u064a\u0641"})})]})]})}),(0,c.jsx)(l.A,{})]})}},5150:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(6213);const n=a.A.create({baseURL:"http://192.168.0.106",withCredentials:!0});let r=!1,l=[];const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;l.forEach((s=>{e?s.reject(e):s.resolve(t)})),l=[]};n.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e})),n.interceptors.response.use((e=>e),(async e=>{const t=e.config;if(t&&!t._retry&&("Access token expired"===e.message||e.response&&401===e.response.status)){if(r)return new Promise(((e,t)=>{l.push({resolve:e,reject:t})})).then((e=>(t.headers.Authorization=`Bearer ${e}`,n(t)))).catch((e=>Promise.reject(e)));t._retry=!0,r=!0;try{const e=await a.A.post("http://192.168.0.106/auth/refresh",{},{withCredentials:!0}),s=e.data.accessToken;e.data.refreshToken;return localStorage.setItem("token",s),o(null,s),t.headers.Authorization=`Bearer ${s}`,n(t)}catch(s){return o(s,null),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),window.location.href="/",Promise.reject(s)}finally{r=!1}}return Promise.reject(e)}));const c=n},6435:(e,t,s)=>{s.d(t,{A:()=>l});s(5043);var a=s(615),n=s(1932),r=s(579);function l(){const e=(0,r.jsx)(a.A,{id:"logout-tooltip",className:"custom-tooltip",children:"\u0627\u0644\u0645\u0628\u0631\u0645\u062c\u064a\u0646 : \u0645\u0635\u0637\u0641\u0649 \u0646\u062c\u0645 - \u062c\u064a\u0627\u0646 \u062d\u0633\u064a\u0646"});return(0,r.jsx)(n.A,{placement:"top",className:"custom-tooltip",overlay:e,children:(0,r.jsxs)("footer",{className:"page-footer",children:["\u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0642\u0648\u0642 \u0645\u062d\u0641\u0648\u0638\u0629 \xa9 ",(new Date).getFullYear()," \u0642\u0633\u0645 \u062a\u0642\u0646\u064a\u0629 \u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062a"]})})}},6957:(e,t,s)=>{s.d(t,{A:()=>d});var a=s(5043),n=s(3216),r=s(5475),l=s(6213),o=s(1932),c=s(615),i=s(579);function d(){const e=(0,n.Zp)(),[t,s]=(0,a.useState)(""),[d,u]=(0,a.useState)("");(0,a.useEffect)((()=>{const e=localStorage.getItem("username");e&&s(e);const t=localStorage.getItem("UserDepartment");t&&u(t)}),[]);const m=(e,t)=>(0,i.jsx)(r.k2,{to:e,className:e=>{let{isActive:t}=e;return"text-decoration-none nav-link"+(t?" active-link":"")},end:!0,"aria-current":"page",children:t});return(0,i.jsxs)("nav",{className:"bg-custom d-flex justify-content-between flex-row-reverse p-3","aria-label":"Primary navigation",children:[(0,i.jsx)("div",{className:"fs-4 fw-bold hlogo",children:(0,i.jsxs)(r.k2,{to:"/dashboard",className:"nav-brand-link",children:["\u0646\u0638\u0627\u0645 \u0627\u0644\u0645\u0646\u062d \u0648\u0627\u0644\u0642\u0631\u0648\u0636",(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"0 10px"},children:(0,i.jsx)("img",{src:"/Images/bank.png",className:"logo-shadow-rounded",alt:"",width:"50px",height:"50px"})})]})}),(0,i.jsxs)("ul",{className:"d-flex flex-row-reverse gap-3 list-unstyled mb-0 align-items-center fw-bold",children:[(0,i.jsx)("li",{children:m("/dashboard","\u0627\u0644\u0635\u0641\u062d\u0629 \u0627\u0644\u0631\u0626\u064a\u0633\u064a\u0629")}),(0,i.jsx)("li",{children:m("/contracts"," \u0627\u0644\u0639\u0642\u0648\u062f")}),(0,i.jsx)("li",{children:m("/Loans"," \u0627\u0644\u0642\u0631\u0648\u0636")}),(0,i.jsx)("li",{children:m("/RevenueList"," \u0627\u0644\u0627\u064a\u0631\u0627\u062f\u0627\u062a")}),(0,i.jsx)("li",{children:m("/AdminPanel","\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u064a\u0646")})]}),(0,i.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,i.jsx)(o.A,{placement:"bottom",overlay:(0,i.jsx)(c.A,{id:"logout-tooltip",children:"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c"}),children:(0,i.jsxs)("button",{"aria-label":"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c",className:"btn btn-outline-danger logoutB",onClick:async()=>{try{await l.A.post("http://localhost:5109/Auth/logout",{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),localStorage.removeItem("token"),localStorage.removeItem("roles"),localStorage.removeItem("username"),e("/")}catch(t){console.error("Logout failed:",t),alert("\u0641\u0634\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c\u060c \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649.")}},type:"button",children:[(0,i.jsx)("span",{className:"navbar-username",children:t.toUpperCase()}),(0,i.jsx)("img",{className:"PowImg",src:"/Images/power.gif",alt:"Power GIF",style:{borderRadius:"50%"},width:"20",height:"20"})]})}),(0,i.jsx)("h6",{className:"headingDep",children:d||"\u0644\u0627 \u064a\u0648\u062c\u062f \u0642\u0633\u0645"}),(0,i.jsx)("span",{className:"navbar-username",children:(0,i.jsx)(r.k2,{to:"/ChangePassword",className:"nav-brand-link",children:"\u062a\u063a\u064a\u064a\u0631 \u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631"})})]})]})}}}]);
//# sourceMappingURL=402.2357dcce.chunk.js.map